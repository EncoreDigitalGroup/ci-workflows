name: PHP Code Analysis

on:
    workflow_call:
        inputs:
            phpVersion:
                type: string
                description: 'PHP Version'
                required: false
                default: '8.2'
            path:
                type: string
                description: 'Path to analyze'
                required: false
                default: 'app/ app_modules/'
            branch:
                type: string
                description: 'The branch to analize'
                required: false
                default: 'main'

jobs:
    StaticAnalysis:
        runs-on: ubuntu-latest
        steps:
            -   uses: shivammathur/setup-php@v2
                with:
                    php-version: ${{ inputs.phpVersion }}
            -   uses: actions/checkout@v4
                with:
                    ref: ${{ inputs.branch }}
            -   name: Install Dependencies
                run: composer install --no-ansi --no-interaction --no-scripts --no-progress --prefer-dist --ignore-platform-reqs
            -   name: Run PHPStan
                run: |
                    $GITHUB_WORKSPACE/vendor/bin/phpstan analyse ${{ inputs.path }}
            -   name: Upgrade to v2.0
                id: upgradeMessage
                run: echo "Version 2.0 has been released. Time to upgrade"